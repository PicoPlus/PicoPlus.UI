@page "/admin/tickets"
@layout Components.Layout.AdminLayout
@using PicoPlus.Services.CRM.Objects
@using PicoPlus.State.Admin
@inject Ticket TicketService
@inject AdminStateService AdminState
@inject ILogger<TicketManagement> Logger

<PageTitle>?????? ??????? - ??? ??????</PageTitle>

<div class="tickets-page">
    <div class="page-header mb-4">
        <div>
            <h2 class="mb-2">
                <i class="bi bi-ticket-perforated me-2"></i>
                ?????? ???????
            </h2>
            @if (selectedOwner != null)
            {
                <p class="text-muted mb-0">????????: <strong>@selectedOwner.FullName</strong></p>
            }
        </div>
        <div class="d-flex gap-2">
            <button class="btn btn-success" @onclick="ShowCreateDialog">
                <i class="bi bi-plus-circle me-2"></i>
                ????? ???? ????
            </button>
            <button class="btn btn-primary" @onclick="LoadTickets">
                <i class="bi bi-arrow-clockwise me-2"></i>
                ?????????
            </button>
        </div>
    </div>

    @if (isLoading)
    {
        <div class="text-center py-5">
            <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;"></div>
            <p class="mt-3 text-muted">?? ??? ?????? ???????...</p>
        </div>
    }
    else
    {
        <div class="card">
            <div class="card-body text-center py-5">
                <i class="bi bi-ticket-perforated display-1 text-muted"></i>
                <h4 class="mt-3">?????? ???????</h4>
                <p class="text-muted">???? ?????? ??????? ?? ???? ????? ????? ??</p>
            </div>
        </div>
    }
</div>

@code {
    private bool isLoading = false;
    private Domain.Admin.HubSpotOwner? selectedOwner;

    protected override async Task OnInitializedAsync()
    {
        await AdminState.InitializeAsync();
        selectedOwner = AdminState.GetSelectedOwner();
    }

    private async Task LoadTickets()
    {
        isLoading = true;
        StateHasChanged();
        
        try
        {
            // TODO: Implement ticket loading
            await Task.Delay(500);
        }
        finally
        {
            isLoading = false;
        }
    }

    private void ShowCreateDialog()
    {
        Logger.LogInformation("Opening create ticket dialog");
    }
}
