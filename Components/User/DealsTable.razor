@using PicoPlus.State.UserPanel
@using PicoPlus.Services.UserPanel

@inject IPersianDateService DateService

<div class="card border-0 shadow-sm">
    <div class="card-header bg-white d-flex justify-content-between align-items-center">
        <h5 class="mb-0 fw-bold">
            <i class="bi bi-list-ul me-2 text-primary"></i>
            لیست معاملات
        </h5>
        <span class="badge text-bg-light border">@Deals.Count مورد</span>
    </div>
    <div class="card-body p-0">
        @if (Deals == null || Deals.Count == 0)
        {
            <div class="p-3">
                <EmptyState IconClass="bi-inbox" Message="معامله‌ای برای نمایش وجود ندارد" AriaLabel="لیست معاملات خالی" />
            </div>
        }
        else
        {
            <div class="table-responsive">
                <table class="table table-hover align-middle mb-0" role="table" aria-label="لیست معاملات">
                    <thead class="table-light">
                        <tr>
                            <th scope="col">شناسه</th>
                            <th scope="col">نام معامله</th>
                            <th scope="col">مبلغ</th>
                            <th scope="col">وضعیت</th>
                            <th scope="col">تاریخ ثبت</th>
                            <th scope="col" class="text-center">عملیات</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var deal in Deals)
                        {
                            var currentDeal = deal;
                            <tr tabindex="0"
                                role="row"
                                @onclick="@(() => OnDealSelected.InvokeAsync(currentDeal))"
                                @onkeydown="@(async (e) => { if (e.Key == \"Enter\" || e.Key == \" \") await OnDealSelected.InvokeAsync(currentDeal); })">
                                <td><code>@deal.Id</code></td>
                                <td>@deal.DealName</td>
                                <td>@DateService.FormatNumber(deal.Amount)</td>
                                <td><StatusBadge Stage="@deal.Stage" /></td>
                                <td>@DateService.FormatDate(deal.CreatedAt)</td>
                                <td class="text-center">
                                    <button type="button" class="btn btn-sm btn-outline-primary"
                                            @onclick="@(() => OnDealSelected.InvokeAsync(currentDeal))"
                                            @onclick:stopPropagation="true">
                                        <i class="bi bi-eye"></i>
                                    </button>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
    </div>
</div>

@code {
    [Parameter, EditorRequired] public IReadOnlyList<DealSummary> Deals { get; set; } = Array.Empty<DealSummary>();
    [Parameter] public EventCallback<DealSummary> OnDealSelected { get; set; }
}
