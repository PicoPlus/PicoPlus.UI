@page "/"
@using PicoPlus.Infrastructure.Services
@inject ISessionStorageService SessionStorage
@inject INavigationService Navigation

<div class="home-redirect-shell" role="status" aria-live="polite">
    <div class="home-redirect-card">
        <div class="spinner-border text-primary home-redirect-spinner" role="status">
            <span class="visually-hidden">در حال بارگذاری...</span>
        </div>
        <h1 class="h5 mb-2">در حال آماده‌سازی پنل شما</h1>
        <p class="text-muted mb-0">لطفاً چند لحظه صبر کنید، در حال انتقال به صفحه مناسب هستیم.</p>

        @if (!string.IsNullOrWhiteSpace(ErrorMessage))
        {
            <div class="alert alert-warning mt-3 mb-0" role="alert">
                @ErrorMessage
            </div>
        }
    </div>
</div>

@code {
    private string? ErrorMessage;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender) return;

        try
        {
            var loginState = await SessionStorage.GetItemAsync<int>("LogInState");
            var targetPath = loginState == 1 ? "/user" : "/auth/login";
            Navigation.NavigateTo(targetPath, forceLoad: true);
        }
        catch
        {
            ErrorMessage = "تشخیص وضعیت ورود انجام نشد. شما به صفحه ورود هدایت می‌شوید.";
            StateHasChanged();
            Navigation.NavigateTo("/auth/login", forceLoad: true);
        }
    }
}
