@page "/user/panel"
@using PicoPlus.Components.User
@using PicoPlus.Components.Shared
@attribute [StreamRendering]
@rendermode @(new InteractiveServerRenderMode(prerender: false))

<link href="/css/user-panel.css" rel="stylesheet" />

<ErrorBoundary>
    <ChildContent>
        <PanelHeader
            Contact="@_vm.State?.Contact"
            OnProfileClick="@ShowProfileTab"
            OnDealsClick="@ShowDealsTab"
            OnSignOutClick="@HandleSignOut" />

        <div class="page-content-dark" dir="rtl">
            <div class="container-fluid py-4">

                @if (_vm.State is not null)
                {
                    <StatisticsCards
                        Statistics="@_vm.State.Statistics"
                        WalletBalance="@(_vm.State.Contact.Wallet ?? 0)" />

                    <PanelTabs
                        ActiveTab="@_vm.ActiveTab"
                        Statistics="@_vm.State.Statistics"
                        OnProfileClick="@ShowProfileTab"
                        OnDealsClick="@ShowDealsTab" />

                    <PanelContent
                        ActiveTab="@_vm.ActiveTab"
                        Contact="@_vm.State.Contact"
                        Deals="@_vm.State.Deals"
                        OnDealSelected="@ShowDealDetails" />
                }
            </div>
        </div>

        <DealDetailsModal
            IsVisible="@(_vm.SelectedDeal is not null)"
            Deal="@_vm.SelectedDeal"
            OnClose="@CloseDealDetails" />

        <LoadingOverlay
            IsVisible="@_vm.IsLoading"
            Message="در حال بارگذاری..." />

        <ErrorToast
            IsVisible="@_vm.HasError"
            ErrorMessage="@_vm.ErrorMessage"
            OnClose="@ClearError" />
    </ChildContent>
    <ErrorContent>
        <div class="page-content-dark" dir="rtl">
            <div class="container py-5">
                <EmptyState
                    IconClass="bi-exclamation-triangle"
                    Message="خطایی در بارگذاری صفحه رخ داده است"
                    ActionText="بازگشت به صفحه ورود"
                    OnActionClick="@NavigateToLogin" />
            </div>
        </div>
    </ErrorContent>
</ErrorBoundary>
